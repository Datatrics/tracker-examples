<script>
	var ecommerce = {{datatrics_ecommerce}};
	if (ecommerce) {
		if(ecommerce.add){
			if(ecommerce.add.products){
				var total = 0;
				for (var k = 0; k < ecommerce.add.products.length; k++) {
					var product = ecommerce.add.products[k];
					total += parseFloat(product.price);
					_paq.push(['addEcommerceItem',
						product.id.toString(),
						product.name,
						product.category,
						product.price,
						product.quantity
					]);
				}
				_paq.push(['trackEcommerceCartUpdate', parseFloat(total)]);
				_paq.push(['trackPageView']);
			}
		}
		if(ecommerce.detail){
			if(ecommerce.detail.products){
				for (var k = 0; k < ecommerce.detail.products.length; k++) {
					var product = ecommerce.detail.products[k];
					_paq.push(['setEcommerceView',
						product.id.toString(),
						product.name,
						product.category,
						product.price
					]);
					_paq.push(['trackPageView']);
				}
			}
			if(ecommerce.detail.product){
				var product = ecommerce.detail.product;
				if(!product.category){ product.category = ''; }
				_paq.push(['setEcommerceView',
					product.id.toString(),
					product.name,
					product.category,
					product.price
				]);
				_paq.push(['trackPageView']);
			}
		}
		if(ecommerce.checkout){
			if(ecommerce.checkout.products){
				var total = 0;
				for (var k = 0; k < ecommerce.checkout.products.length; k++) {
					var product = ecommerce.checkout.products[k];
					total += parseFloat(product.price);
					_paq.push(['addEcommerceItem',
						product.id.toString(),
						product.name,
						product.category,
						product.price,
						product.quantity
					]);
				}
				_paq.push(['trackEcommerceCartUpdate', parseFloat(total)]);
				_paq.push(['trackPageView']);
			}
		}
		if(ecommerce.purchase){
			if(ecommerce.purchase.products){
				for (var k = 0; k < ecommerce.purchase.products.length; k++) {
					var product = ecommerce.purchase.products[k];
					_paq.push(['addEcommerceItem',
						product.id.toString(),
						product.name,
						product.category,
						product.price,
						product.quantity
					]);
				}
				_paq.push(['trackEcommerceOrder',
					ecommerce.purchase.actionField.id,
					ecommerce.purchase.actionField.revenue,
					ecommerce.purchase.actionField.revenue-ecommerce.purchase.actionField.tax,
					ecommerce.purchase.actionField.tax,
					ecommerce.purchase.actionField.shipping,
					false
				]);
				_paq.push(['trackPageView']);
			}
		}
	}
</script>
